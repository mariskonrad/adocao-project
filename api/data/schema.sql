DROP TABLE IF EXISTS pet CASCADE;
DROP TABLE IF EXISTS comment CASCADE;
DROP TABLE IF EXISTS event CASCADE;
DROP TABLE IF EXISTS user_account CASCADE;
DROP TABLE IF EXISTS account_permission CASCADE;
DROP TABLE IF EXISTS breed CASCADE;

CREATE TABLE user_account (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	name VARCHAR(255) NOT NULL,
	email VARCHAR(255) NOT NULL,
	password VARCHAR(512) NOT NULL,
	active BOOLEAN NOT NULL
);

ALTER TABLE user_account ADD CONSTRAINT pk_user_account PRIMARY KEY (id);
ALTER TABLE user_account ADD CONSTRAINT uk_email UNIQUE (email);

CREATE TABLE account_permission (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	role VARCHAR(100) NOT NULL,
	user_id BIGINT NOT NULL
);

ALTER TABLE account_permission ADD CONSTRAINT pk_account_permission PRIMARY KEY(id);
ALTER TABLE account_permission ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES user_account;

CREATE TABLE breed (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	breed_name VARCHAR(512) NOT NULL
);

ALTER TABLE breed ADD CONSTRAINT pk_breed PRIMARY KEY (id);

CREATE TABLE pet (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	name VARCHAR(100) NOT NULL,
	age INT NOT NULL,
	size VARCHAR(6) NOT NULL,
	sex VARCHAR(10) NOT NULL,
	breed_id BIGINT NOT NULL,
	image VARCHAR(512) NOT NULL,
	available BOOLEAN NOT NULL
);

ALTER TABLE pet ADD CONSTRAINT pk_pet PRIMARY KEY (id);
ALTER TABLE pet ADD CONSTRAINT fk_breed FOREIGN KEY (breed_id) REFERENCES breed;
ALTER TABLE pet ADD CONSTRAINT allowed_sizes CHECK (size IN ('SMALL', 'MEDIUM', 'BIG'));
ALTER TABLE pet ADD CONSTRAINT allowed_sexes CHECK (sex IN ('F', 'M'));

CREATE TABLE comment (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	pet_id BIGINT NOT NULL,
	text VARCHAR(512) NOT NULL
);

ALTER TABLE comment ADD CONSTRAINT pk_comment PRIMARY KEY (id);
ALTER TABLE comment ADD CONSTRAINT fk_comment FOREIGN KEY (pet_id) REFERENCES pet;

CREATE TABLE event (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	description VARCHAR(1024) NOT NULL,
	start_event TIMESTAMP NOT NULL,
	location VARCHAR(512) NOT NULL,
	image VARCHAR(512) NOT NULL
);

ALTER TABLE event ADD CONSTRAINT pk_event PRIMARY KEY (id);
